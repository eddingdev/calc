<div class="d-flex flex-column"
     style="height: 100%">
  <div style="flex: 1 0 auto;"
       [ngClass]="{'dark': darkMode}">
    <div class="gridMain">
      <div class="header">
        <h3> Archaeology Artefact Material Calculator </h3>
        <button *ngIf="!darkMode"
                class="btn btn-info"
                (click)="toggleDarkMode(true)">ðŸŒž</button>
        <button *ngIf="darkMode"
                class="btn btn-info"
                (click)="toggleDarkMode(false)">ðŸŒ‘</button>
      </div>
      <div class="info" >
        <div>
          <p>
            Here is just a tool I quickly put together to calculate the materials needed for given artefact.
            <br>
            Simply select what artifacts you plan on making and at the list of the materials you need will appear.

            <br>

            All artefact have been added!

            <br>
            If you notice any issues please let me know in game or tag me in Archaeology discord!
            <br>
            Special thanks to KhaleesiZara & Anilokip4 for helping me with this!
            <br>
            Mikemicmike
          </p>
        </div>
        <div>
          <div class="card">
            <div class="card-header"
                 style="cursor: pointer;"
                 (click)="toggleXpCalcCollapse()">
              <strong>
                XP Calculator
              </strong>
              <div class="float-right">
                <button *ngIf="!xpCalcCollapsed && byLevel"
                        class="btn btn-info btn-sm"
                        (click)="swapTarget($event)">Use Target XP</button>
                <button *ngIf="!xpCalcCollapsed && !byLevel"
                        class="btn btn-info btn-sm"
                        (click)="swapTarget($event)">Use Target Level</button>
                <span *ngIf="xpCalcCollapsed"
                      class="ml-2 mdi mdi-chevron-up"></span>
                <span *ngIf="!xpCalcCollapsed"
                      class="ml-2 mdi mdi-chevron-down"></span>
              </div>
            </div>
            <div class="card-body"
                 *ngIf="!xpCalcCollapsed">
              <div class="row">
                <div class="col">
                  <p>
                    This calculator assumes 20% of the xp each level will come from excavating artefacts. This number is an estimate. If you feel it is wrong please let me
                    know in game or tag me in the Archaeology Discord.
                  </p>
                </div>
              </div>
              <div class="form-group row">
                <label for="currentxp"
                       class="col-sm-2 col-form-label">Current XP</label>
                <div class="col-sm-6">
                  <input type="number"
                         class="form-control form-control-sm"
                         [(ngModel)]="currentXp"
                         (input)="currentXpChanged()"
                         id="currentxp"
                         placeholder="Current XP">
                </div>
                <div class="col-sm-4"
                     *ngIf="currentLevel">
                  Level {{currentLevel}}
                </div>
              </div>
              <div *ngIf="byLevel"
                   class="form-group row">
                <label for="targetLevel"
                       class="col-sm-2 col-form-label">Target Level</label>
                <div class="col-sm-6">
                  <input type="number"
                         class="form-control form-control-sm"
                         [(ngModel)]="targetLevel"
                         (input)="targetLevelChanged()"
                         id="targetLevel"
                         placeholder="Target Level">
                </div>
                <div class="col-sm-4"
                     *ngIf="targetXp">
                  {{targetXp | number}} XP
                </div>
              </div>
              <div *ngIf="!byLevel"
                   class="form-group row">
                <label for="targetXp"
                       class="col-sm-2 col-form-label">Target XP</label>
                <div class="col-sm-6">
                  <input type="number"
                         class="form-control form-control-sm"
                         [(ngModel)]="targetXp"
                         (input)="targetXpChanged()"
                         id="targetXp"
                         placeholder="Target XP">
                </div>
                <div class="col-sm-4"
                     *ngIf="targetLevel">
                  Level {{targetLevel}}
                </div>
              </div>
              <div class="form-group row">
                <label for="targetLevel"
                       class="col-sm-2 col-form-label">Outfit Pieces</label>
                <div class="col-sm-6">
                  <input type="number"
                         class="form-control form-control-sm"
                         [(ngModel)]="outfitPieces"
                         (input)="outfitPiecesChanged()"
                         id="outfitPieces"
                         placeholder="Outfit Pieces">
                </div>
                <div class="col-sm-4">
                  Modifier: {{xpModifier}}
                </div>
              </div>
              <table *ngIf="neededArtefacts.length"
                     class="table table-condensed table-striped table-bordered">
                <tr>
                  <th style="width: 100px;">
                    Quantity
                  </th>
                  <th>
                    Artefact Level
                  </th>
                </tr>
                <tr *ngFor="let artefact of neededArtefacts">
                  <td style="width: 100px;">
                    {{artefact.quantity | number:"0.0-1"}}
                  </td>
                  <td>
                    Level {{artefact.level}} Artefacts
                  </td>
                </tr>
              </table>
            </div>
          </div>
        </div>
      </div>

      <div class="calculator">
        <div>
          <div class="calcHeader">
              <h4>Choose your Artifacts</h4>
              <span>
                <button *ngIf="byFaction"
                        (click)="changeByFaction(false)"
                        class="btn btn-info">Show By Collection</button>
                <button *ngIf="!byFaction"
                        (click)="changeByFaction(true)"
                        class="btn btn-info">Show By Faction</button>
                <button class="btn btn-danger ml-1"
                        (click)="resetAll()">Reset All</button>
                <button (click)="resetArtefacts()"
                  class="btn btn-danger ml-1">Remove all Artefacts</button>
              </span>
                     
              <input type="text"
                      class="form-control mt-1"
                      (input)="filterResults()"
                      placeholder="Search"
                      [(ngModel)]="search">
          </div>
          <div class="card"
               *ngFor="let entry of data">
            <div class="card-header"
                 style="cursor: pointer;"
                 [ngStyle]="{'background-color': entry.color}"
                 [ngClass]="{'dark-text': byFaction}"
                 (click)="entry.collapsed = !entry.collapsed">
              <h5>{{entry.label}} - Level {{entry.levelReq}}
                <div class="float-right">
                  <span *ngIf="entry.collapsed"
                        class="mdi mdi-chevron-up"></span>
                  <span *ngIf="!entry.collapsed"
                        class="mdi mdi-chevron-down"></span>
                </div>
              </h5>
            </div>
            <div class="card-body"
                 *ngIf="!entry.collapsed">
              <div class="itemsContainer">
                <div
                    class="item"
                    style="border: 1px solid #ccc;"
                    *ngFor="let artefact of entry.artefacts">
                  <div class="title">{{artefact.level}} - {{artefact.label | titlecase}}</div>
                  <div class="input-group">
                    <button class="input-group-prepend btn btn-success"
                            [disabled]="artefact.quantity === 0"
                            (click)="removeArtefact(artefact)"><span class="mdi mdi-minus"></span></button>
                    <input type="number"
                           class="form-control"
                           (input)="calculateTotals()"
                           [(ngModel)]="artefact.quantity">
                    <button class="input-group-append btn btn-success"
                            (click)="addArtefact(artefact)"><span class="mdi mdi-plus"></span></button>
                  </div>
                </div>
              </div>

            </div>

          </div>
        </div>
        <div>
          <div class="row">
            <div class="col">
              <h2>Results</h2>
              <h4>Chosen Artefacts</h4>
            </div>
          </div>
          <div class="row">
            <div class="col">
              <ul class="list-group">
                <li *ngFor="let artefact of chosenArtefacts"
                    class="list-group-item">
                  {{artefact.quantity}} {{artefact.label | titlecase}} ({{artefact.xp}}xp each)
                </li>
              </ul>
              <h6 *ngIf="totalXp">Total XP: {{totalXp | number:'1.0-0'}}</h6>
              <h6 *ngIf="totalXp">Total XP with Outfit: {{totalXp * 1.06 | number:'1.0-0'}}</h6>
            </div>
          </div>
          <div class="row mt-2">
            <div class="col">
              <h4>Required Materials</h4>
            </div>
          </div>
          <div class="row">
            <div class="col-xl-6 material-card-holder"
                 *ngFor="let material of neededMaterials">
              <div class="p-2 material-card">
                {{material.quantity}} {{material.type.label}}
              </div>
            </div>
          </div>
          <div class="row mt-2">
            <div class="col">
              <h4>
                Owned Materials
                <button (click)="removeOwnedMaterials()"
                        class="btn btn-danger">Remove Owned</button>
              </h4>
            </div>
          </div>
          <div class="row">
            <div class="col-xl-6 material-card-holder"
                 *ngFor="let material of neededMaterials">
              <div class="p-2 material-card">
                <input type="number"
                       class="form-control"
                       style="max-width: 100px; display: inline"
                       [(ngModel)]="componentTypes[material.type.id].owned">
                {{material.type.label}}
              </div>
            </div>
          </div>
          <div class="row mt-2">
            <div class="col">
              <h4>Needed Materials</h4>
            </div>
          </div>
          <div class="row">
            <ng-template ngFor
                         let-material
                         [ngForOf]="neededMaterials">
              <div class="col-xl-6 material-card-holder"
                   *ngIf="!componentTypes[material.type.id].owned ||componentTypes[material.type.id].owned < material.quantity">
                <div class="p-2 material-card">
                  <div class="row">
                    <div class="col-8 pt-1">
                      <span [ngClass]="{'strike-through': componentTypes[material.type.id].done}">

                        <span *ngIf="componentTypes[material.type.id].owned">
                          {{material.quantity - componentTypes[material.type.id].owned }}
                        </span>
                        <span *ngIf="!componentTypes[material.type.id].owned">
                          {{material.quantity}}
                        </span>
                        {{material.type.label}}
                      </span>
                    </div>
                    <div class="col-4">
                      <div class="pr-2">
                        <button *ngIf="!componentTypes[material.type.id].done"
                                (click)="markComplete(componentTypes[material.type.id])"
                                class="btn btn-info btn-block btn-sm">Done</button>
                        <button *ngIf="componentTypes[material.type.id].done"
                                (click)="unmarkComplete(componentTypes[material.type.id])"
                                class="btn btn-info btn-blockbtn-sm">Undo</button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </ng-template>
          </div>
        </div>
      </div>
    </div>
  </div>
  <footer id="sticky-footer"
          class="pt-1 pb-2 bg-dark text-white-50">
    <div class="container text-center">
      <small>Copyright 2020 &copy; RSN: Mikemicmike & KhaleesiZara - Clan: Rise of the Abyss</small>
    </div>
  </footer>
</div>